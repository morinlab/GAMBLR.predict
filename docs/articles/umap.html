<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>DLBCLone Functions — UMAP • GAMBLR.predict</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="umap_files/libs/quarto-html/popper.min.js"></script><script src="umap_files/libs/quarto-html/tippy.umd.min.js"></script><link href="umap_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="umap_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="DLBCLone Functions — UMAP">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">GAMBLR.predict</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/index.html">DLBCLone</a></li>
    <li><a class="dropdown-item" href="../articles/umap.html">DLBCLone Functions — UMAP</a></li>
    <li><a class="dropdown-item" href="../articles/DLBCLone_optimize_params.html">DLBCLone Functions — Optimizing Parameters</a></li>
    <li><a class="dropdown-item" href="../articles/DLBCLone_stored.html">DLBCLone Functions — DLBCLone Model Management</a></li>
    <li><a class="dropdown-item" href="../articles/predict_samples.html">UNKNOWN TITLE</a></li>
    <li><a class="dropdown-item" href="../articles/full_walkthrough.html">DLBCLone Full Walkthrough of Associated Functions</a></li>
    <li><a class="dropdown-item" href="../articles/validation.html">DLBCLone — Validation Data Generation and Example</a></li>
    <li><a class="dropdown-item" href="../articles/DLBCLone_KNN.html">DLBCLone Functions — K-Nearest Neighbors</a></li>
    <li><a class="dropdown-item" href="../articles/DLBCLone_mixture_model.html">DLBCLone Functions — Gaussian Mixture Model</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>DLBCLone Functions — UMAP</h1>





      <div class="d-none name"><code></code></div>
    </div>






    <section class="section level2"><h2 id="make_and_annotate_umap">make_and_annotate_umap<a class="anchor" aria-label="anchor" href="#make_and_annotate_umap"></a>
</h2>
<p>This function accepts your training data as input, and will run a UMAP projection attaching the result to your metadata. This is a foundational step for running DLBCLone.</p>
<p>If you are not confident the UMAP is separating classes well, you can encourage better separation by assigining certain “core” genes a higher weight. This is done by specifying a vector of feature names that will have their values multiplied by 1.5. There is also a convenience option <code>problem_genes</code> to exclude/ignore certain features that are in your matrix if you think they aren’t helpful.</p>
<p><code>df</code> feature matrix with one row per sample and one column per mutation</p>
<p><code>metadata</code> data frame with one row per sample and a column sample_id that matches the row names of the data frame. This data frame will be joined to the UMAP output</p>
<p><code>umap_out</code> insert a UMAP output from a previous run. If provided, the function will use this model to project the data instead of re-running UMAP. This is neccessary for future functions setting a static projection of UMAP coordinates that then will stay in place and not move. Run this param to ensure reproducibility of results</p>
<p><code>core_features</code> a vector of column names in df that should be multiplied by core_feature_multiplier. These features are considered “core” and will be weighted more heavily in the UMAP embedding</p>
<p><code>core_feature_multiplier</code> a numeric value that will be used to multiply the core features specified in core_features (default: 1.5)</p>
<p><code>hidden_features</code> a vector of column names in df that should be dropped from the UMAP input. These features are considered “hidden” and will not be used in the UMAP embedding</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mu_everything</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_and_annotate_umap.html">make_and_annotate_umap</a></span><span class="op">(</span></span>
<span>  <span class="va">best_opt_model_matrix</span>,</span>
<span>  <span class="va">dlbcl_meta_clean</span>,</span>
<span>  core_features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    ST2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SGK1"</span>,<span class="st">"DUSP2"</span>,<span class="st">"TET2"</span>,<span class="st">"SOCS1"</span><span class="op">)</span>,</span>
<span>    N1<span class="op">=</span><span class="st">"NOTCH1"</span>,</span>
<span>    EZB<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EZH2"</span>,<span class="st">"BCL2_SV"</span><span class="op">)</span>,</span>
<span>    MCD<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MYD88HOTSPOT"</span>,<span class="st">"CD79B"</span>,<span class="st">"PIM1"</span><span class="op">)</span>,</span>
<span>    BN2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BCL6_SV"</span>,<span class="st">"NOTCH2"</span>,<span class="st">"SPEN"</span>,<span class="st">"CD70"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>list of core features detected.Will group features from each class.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>removed 164 (6.45%) rows from the data that had no features</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>kept 2378 rows of the data that have features and match the metadata provided</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>running tumap</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>done!</code></pre>
</div>
</div>
</section><section class="section level2"><h2 id="make_umap_scatterplot">make_umap_scatterplot<a class="anchor" aria-label="anchor" href="#make_umap_scatterplot"></a>
</h2>
<p>A plotting function for the UMAP projection.</p>
<p><code>df</code> data frame containing the UMAP coordinates and annotations</p>
<p><code>drop_composite</code> if TRUE: removes composite labels from the lymphgen column</p>
<p><code>colour_by</code> column name to color points by</p>
<p><code>drop_other</code> if TRUE: removes “Other” and “NOS” labels from the lymphgen column</p>
<p><code>high_confidence</code> if TRUE: filters the data to include only samples with confidence &gt; 0.7</p>
<p><code>custom_colours</code> custom color palette for the plot. If not provided, uses default GAMBL colors</p>
<p><code>add_labels</code> if TRUE: adds labels to the points based on the median coordinates of each group</p>
<p><code>title</code> Plot title</p>
<p><code>base_size</code> Base font and point size for the plot (passed to theme_Morons())</p>
<p><code>alpha</code> Point transparency (default: 0.8)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/make_umap_scatterplot.html">make_umap_scatterplot</a></span><span class="op">(</span></span>
<span>  <span class="va">mu_everything</span><span class="op">$</span><span class="va">df</span>,</span>
<span>  drop_other <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="umap_files/figure-html/plot1-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/make_umap_scatterplot.html">make_umap_scatterplot</a></span><span class="op">(</span></span>
<span>  <span class="va">mu_everything</span><span class="op">$</span><span class="va">df</span>,</span>
<span>  drop_other <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="umap_files/figure-html/plot2-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section class="section level2"><h2 id="using-a-umap-model-to-project-the-same-data">Using a UMAP model to project the same data<a class="anchor" aria-label="anchor" href="#using-a-umap-model-to-project-the-same-data"></a>
</h2>
<p>For reproducibility, future use, and faster run times, DLBCLone will re-project your umap output when optimizing parameters. As a proof of concept, we will reproject the same data using the <code>umap_out</code> paramter of <code>make_and_annotate_umap</code>. This step iteratively places each sample into the same latent space using the model generated in the last step. In this case, the location of other samples doesn’t influence where each sample is placed. This is important because it means the result will be deterministic regardless of the order in which you specify samples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mu_everything_proj</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_and_annotate_umap.html">make_and_annotate_umap</a></span><span class="op">(</span></span>
<span>  <span class="va">mu_everything</span><span class="op">$</span><span class="va">features</span>,</span>
<span>  <span class="va">dlbcl_meta_clean</span>,</span>
<span>  umap_out <span class="op">=</span> <span class="va">mu_everything</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/make_umap_scatterplot.html">make_umap_scatterplot</a></span><span class="op">(</span></span>
<span>  <span class="va">mu_everything_proj</span><span class="op">$</span><span class="va">df</span>,</span>
<span>  drop_other <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="umap_files/figure-html/project-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
</section><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'light-border',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config);
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script></main>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kostiantyn Dreval.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
