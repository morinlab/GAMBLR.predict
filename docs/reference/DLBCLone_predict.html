<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Predict DLBCL genetic subgroup for one or more samples using a pre-trained DLBCLone model — DLBCLone_predict • GAMBLR.predict</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Predict DLBCL genetic subgroup for one or more samples using a pre-trained DLBCLone model — DLBCLone_predict"><meta name="description" content="Projects new samples into a frozen UMAP space from a pre-trained
DLBCLone model and assigns subtype labels with a weighted k-NN
classifier. The function aligns features between the input matrix and
the training model, optionally constructs/weights meta-features
(*_feats) based on the model's core_features, and prevents
label leakage by excluding the test sample from its own neighbor set."><meta property="og:description" content="Projects new samples into a frozen UMAP space from a pre-trained
DLBCLone model and assigns subtype labels with a weighted k-NN
classifier. The function aligns features between the input matrix and
the training model, optionally constructs/weights meta-features
(*_feats) based on the model's core_features, and prevents
label leakage by excluding the test sample from its own neighbor set."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">GAMBLR.predict</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/index.html">DLBCLone</a></li>
    <li><a class="dropdown-item" href="../articles/umap.html">DLBCLone Functions — UMAP</a></li>
    <li><a class="dropdown-item" href="../articles/DLBCLone_optimize_params.html">DLBCLone Functions — Optimizing Parameters</a></li>
    <li><a class="dropdown-item" href="../articles/DLBCLone_stored.html">DLBCLone Functions — DLBCLone Model Management</a></li>
    <li><a class="dropdown-item" href="../articles/predict_samples.html">UNKNOWN TITLE</a></li>
    <li><a class="dropdown-item" href="../articles/full_walkthrough.html">DLBCLone Full Walkthrough of Associated Functions</a></li>
    <li><a class="dropdown-item" href="../articles/validation.html">DLBCLone — Validation Data Generation and Example</a></li>
    <li><a class="dropdown-item" href="../articles/DLBCLone_KNN.html">DLBCLone Functions — K-Nearest Neighbors</a></li>
    <li><a class="dropdown-item" href="../articles/DLBCLone_mixture_model.html">DLBCLone Functions — Gaussian Mixture Model</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Predict DLBCL genetic subgroup for one or more samples using a pre-trained DLBCLone model</h1>

      <div class="d-none name"><code>DLBCLone_predict.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Projects new samples into a frozen UMAP space from a pre-trained
DLBCLone model and assigns subtype labels with a weighted k-NN
classifier. The function aligns features between the input matrix and
the training model, optionally constructs/weights meta-features
(<code>*_feats</code>) based on the model's <code>core_features</code>, and prevents
label leakage by excluding the test sample from its own neighbor set.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">DLBCLone_predict</span><span class="op">(</span></span>
<span>  <span class="va">mutation_status</span>,</span>
<span>  <span class="va">optimized_model</span>,</span>
<span>  fill_missing <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  drop_extra <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  check_frequencies <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  dry_run <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">12345</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-mutation-status">mutation_status<a class="anchor" aria-label="anchor" href="#arg-mutation-status"></a></dt>
<dd><p>Data frame or matrix with one row per sample and one
column per feature (typically binary or count mutation indicators).
Row names must be unique sample IDs. Columns should correspond to the
features the model was trained on. Extra/missing features are handled by
<code>drop_extra</code> and <code>fill_missing</code>.</p></dd>


<dt id="arg-optimized-model">optimized_model<a class="anchor" aria-label="anchor" href="#arg-optimized-model"></a></dt>
<dd><p>A pre-trained DLBCLone model object as returned by
<code><a href="DLBCLone_load_optimized.html">DLBCLone_load_optimized()</a></code> (or saved via
<code><a href="DLBCLone_save_optimized.html">DLBCLone_save_optimized()</a></code>). Must contain fields such as
<code>$model</code> (uwot UMAP), <code>$features</code> (training feature matrix),
<code>$df</code> (training metadata incl. <code>sample_id</code>, <code>lymphgen</code>),
<code>$best_params</code> (e.g., <code>na_option</code>, <code>threshold</code>,
<code>use_weights</code>), and <code>$k_DLBCLone_w</code>. Optional fields include
<code>$core_features</code>, <code>$core_feature_multiplier</code>,
<code>$purity_DLBCLone_w</code>, <code>$score_thresh_DLBCLone_w</code>, and
<code>$truth_classes</code>.</p></dd>


<dt id="arg-fill-missing">fill_missing<a class="anchor" aria-label="anchor" href="#arg-fill-missing"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, any features that exist in the
model but are absent in <code>mutation_status</code> are added and set to zero
for all samples (with a warning). If <code>FALSE</code>, missing model features
cause an error. Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-drop-extra">drop_extra<a class="anchor" aria-label="anchor" href="#arg-drop-extra"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, any features present in
<code>mutation_status</code> but not seen during model training are dropped
(with a message). If <code>FALSE</code>, extra features cause an error.
Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-check-frequencies">check_frequencies<a class="anchor" aria-label="anchor" href="#arg-check-frequencies"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, the function does not run
prediction. Instead, it computes and returns a per-feature frequency
comparison between test and training cohorts (binary presence/absence),
along with a ggplot highlighting large deviations. Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-dry-run">dry_run<a class="anchor" aria-label="anchor" href="#arg-dry-run"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, return the preprocessed/weighted
test feature matrix (after column alignment and any core-feature
weighting/meta-feature construction) without running projection or
classification. Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Integer seed passed to embedding/projection steps for
reproducibility. Defaults to <code>12345</code>.</p></dd>


<dt id="arg-annotate-accuracy">annotate_accuracy<a class="anchor" aria-label="anchor" href="#arg-annotate-accuracy"></a></dt>
<dd><p>Logical. Currently unused (reserved for future
output annotations). Defaults to <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with elements (fields may vary depending on options/model):</p><ul><li><p><code>prediction</code>: data frame of per-sample predictions joined to
test UMAP coordinates (<code>V1</code>, <code>V2</code>) and any vote metrics.</p></li>
<li><p><code>projection</code>: data frame of projected test coordinates.</p></li>
<li><p><code>umap_input</code>: the model's training feature matrix
(<code>optimized_model$features</code>).</p></li>
<li><p><code>model</code>: the frozen UMAP model used for projection
(<code>optimized_model$model</code>).</p></li>
<li><p><code>features_df</code>: the processed test feature matrix used for
projection/classification (rows = samples).</p></li>
<li><p><code>df</code>: alias of <code>prediction</code> (kept for compatibility).</p></li>
<li><p><code>metadata</code>: the model's training metadata (<code>optimized_model$df</code>).</p></li>
<li><p><code>type</code>: string identifier <code>"DLBCLone_predict"</code>.</p></li>
<li><p><code>unprocessed_votes</code>: predictions before post-processing.</p></li>
<li><p>(optional) <code>core_features</code>, <code>core_feature_multiplier</code>,
<code>mutation_status</code>: included when core-feature weighting was applied.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Feature alignment.</strong> Columns in <code>mutation_status</code> must match the
model's training features. Set <code>drop_extra=TRUE</code> to drop unexpected
columns, and <code>fill_missing=TRUE</code> to add missing model columns (filled
with zero). If, after adjustment, columns do not exactly match (including
order), the function stops with an error.</p>
<p><strong>Core features &amp; meta-features.</strong> If <code>optimized_model$core_features</code>
is:</p><ul><li><p>a <em>list</em> of feature groups, the function creates meta-features
(columns suffixed with <code>"_feats"</code>) as the (weighted) mean of
each group's members. When <code>core_feature_multiplier</code> is a list,
group-specific numeric weights are applied.</p></li>
<li><p>a <em>character vector</em>, core features may be multiplicatively
up-weighted by <code>core_feature_multiplier</code> to match training
scale if they do not already appear weighted in the input.</p></li>
</ul><p><strong>Projection &amp; classification.</strong> Both training and test samples are
projected into the same frozen UMAP space (no retraining) via
<code>make_and_annotate_umap(..., umap_out=optimized_model, ret_model=FALSE)</code>.
For each test sample, neighbors are drawn from the projected training set
with that test sample removed to prevent self-label leakage. Labels are
assigned using <code><a href="weighted_knn_predict_with_conf.html">weighted_knn_predict_with_conf()</a></code> with
<code>k=optimized_model$k_DLBCLone_w</code>, confidence threshold
<code>best_params$threshold</code>, optional distance weighting
<code>best_params$use_weights</code>, and <code>max_neighbors</code>. The
<code>other_class</code> is currently fixed as <code>"Other"</code>.</p>
<p><strong>Post-processing (optional).</strong> If the model contains
<code>$purity_DLBCLone_w</code> and/or <code>$score_thresh_DLBCLone_w</code>, the raw
vote outputs are passed to <code><a href="process_votes.html">process_votes()</a></code> to derive
<code>DLBCLone_w</code> and <code>DLBCLone_wo</code> decisions using score and ratio
criteria. When available, <code>$truth_classes</code> are used to order/interpret
group labels.</p>
<p><strong>Early-return modes.</strong></p><ul><li><p><code>check_frequencies=TRUE</code>: returns a list with a ggplot object
and a frequency deviation data frame; no projection/prediction.</p></li>
<li><p><code>dry_run=TRUE</code>: returns the processed test feature matrix
(after alignment/weighting); no projection/prediction.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="errors-and-messages">Errors and messages<a class="anchor" aria-label="anchor" href="#errors-and-messages"></a></h2>


<p>The function stops if feature columns cannot be reconciled (see
<code>drop_extra</code>, <code>fill_missing</code>), or if, after alignment, the column
order/identity does not exactly match the training features. Messages are
emitted when dropping/adding features or when core-feature weighting is
inferred/applied or skipped.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="DLBCLone_load_optimized.html">DLBCLone_load_optimized</a></code>, <code><a href="DLBCLone_save_optimized.html">DLBCLone_save_optimized</a></code>,
<code><a href="make_and_annotate_umap.html">make_and_annotate_umap</a></code>, <code><a href="weighted_knn_predict_with_conf.html">weighted_knn_predict_with_conf</a></code>,
<code><a href="process_votes.html">process_votes</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Typical usage</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="DLBCLone_load_optimized.html">DLBCLone_load_optimized</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"models"</span>, name_prefix <span class="op">=</span> <span class="st">"DLBCLone_LySeqST"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Inspect distribution shifts without running classification</span></span></span>
<span class="r-in"><span><span class="va">freq_chk</span> <span class="op">&lt;-</span> <span class="fu">DLBCLone_predict</span><span class="op">(</span></span></span>
<span class="r-in"><span>  mutation_status <span class="op">=</span> <span class="va">my_panelX_matrix</span>,</span></span>
<span class="r-in"><span>  optimized_model <span class="op">=</span> <span class="va">model</span>,</span></span>
<span class="r-in"><span>  check_frequencies <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">freq_chk</span><span class="op">$</span><span class="va">plot</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">freq_chk</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu">DLBCLone_predict</span><span class="op">(</span></span></span>
<span class="r-in"><span>  mutation_status <span class="op">=</span> <span class="va">feat_status_LySeqST</span>,  <span class="co"># rows = samples, cols = features</span></span></span>
<span class="r-in"><span>  optimized_model <span class="op">=</span> <span class="va">model</span>,</span></span>
<span class="r-in"><span>  drop_extra <span class="op">=</span> <span class="cn">TRUE</span>,    <span class="co"># drop unexpected columns</span></span></span>
<span class="r-in"><span>  fill_missing <span class="op">=</span> <span class="cn">TRUE</span>   <span class="co"># add any missing model columns as zeros</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">preds</span><span class="op">$</span><span class="va">prediction</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Dry run to see the meta-features after alignment/weighting</span></span></span>
<span class="r-in"><span><span class="va">processed</span> <span class="op">&lt;-</span> <span class="fu">DLBCLone_predict</span><span class="op">(</span></span></span>
<span class="r-in"><span>  mutation_status <span class="op">=</span> <span class="va">my_panelX_matrix</span>,</span></span>
<span class="r-in"><span>  optimized_model <span class="op">=</span> <span class="va">model</span>,</span></span>
<span class="r-in"><span>  dry_run <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">processed</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kostiantyn Dreval.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

