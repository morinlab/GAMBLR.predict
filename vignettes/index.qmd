---
title: "DLBCLone"
vignette: >
  %\VignetteIndexEntry{quarto vignettes}
  %\VignetteEngine{quarto::html}
  %\VignetteEncoding{UTF-8}
from: markdown+emoji
fig.align: "center"
---

# Preface 

*The one classifier to classify all*

DLBCLone is a data-driven, open-source classifier for diffuse large B-cell lymphoma (DLBCL) genetic subtypes. It combines [UMAP](https://arxiv.org/abs/1802.03426) for dimensionality reduction, with a weighted k-nearest neighbors ([KNN](https://www.datacamp.com/tutorial/k-nearest-neighbors-knn-classification-with-r-tutorial)) algorithm to label samples based on neighborhood association.

The tool is designed to address key limitations of the current primary classifiers; [LymphGen](https://llmpp.nih.gov/lymphgen/index.php) and [DLBclass](https://innovations.dana-farber.org/technology/dlbclass-a-breakthrough-in-diagnosing-and-managing-diffuse-large-b-cell-lymphoma/). LymphGen often labels a large proportion of samples as “Other,” while DLBclass frequently produces low-confidence predictions.

DLBCLone incorporates threshold optimization strategies to adapt to the structure of your input data. When trained on LymphGen-labeled cohorts, it can reclassify “Other” samples into genetic subtypes by leveraging their nearest neighbors in the UMAP space, providing subtype calls with associated confidence scores.

# Introduction

This tutorial introduces how to use all of DLBCLone's functions. 

Package Requirements to run DLBCLone:
```{r, echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
library(GAMBLR.open)
library(GAMBLR.predict)
library(tidyverse)
library(ComplexHeatmap)
library(uwot)
library(caret)
library(FNN)
library(ggalluvial)
library(ggbeeswarm)
library(ggExtra)
library(ggrepel)
library(dbscan)
library(mvtnorm)
library(ggside)
```

Load the GAMBLR.predict package associated feature matrix and metadata files from extdata: 
```{r, message=FALSE, warning=FALSE, eval = FALSE}
dlbcl_meta = readr::read_tsv(system.file("extdata/dlbcl_meta_with_dlbclass.tsv",package = "GAMBLR.predict"))

dlbcl_meta_clean = filter(dlbcl_meta,
                          lymphgen %in% c("MCD","EZB","BN2","N1","ST2","Other"))

all_full_status = readr::read_tsv(system.file("extdata/all_full_status.tsv",package = "GAMBLR.predict")) %>%
  tibble::column_to_rownames("sample_id")
```

The examples covering how to run DLBCLone will use the following all_full_status features:
```{r, message=FALSE, warning=FALSE, eval = FALSE}
best_opt_model_genes <- sort(c(
  "ACTB", "ACTG1", "BCL10", "BCL2", "BCL2L1", 
  "BCL6", "BIRC3", "BRAF", "BTG1", "BTG2", 
  "BTK", "CD19", "CD70", "CD79B", "CD83", 
  "CDKN2A", "CREBBP", "DDX3X", "DTX1", "DUSP2", 
  "EDRF1", "EIF4A2", "EP300", "ETS1", "ETV6", 
  "EZH2", "FAS", "FCGR2B", "FOXC1", "FOXO1", 
  "GNA13", "GRHPR", "HLA-A", "HLA-B", "HNRNPD", 
  "IRF4", "IRF8", "ITPKB", "JUNB", "KLF2", 
  "KLHL14", "KLHL6", "KMT2D", "MEF2B", "MPEG1", 
  "MYD88", "NFKBIA", "NFKBIE", "NFKBIZ", "NOL9", 
  "NOTCH1", "NOTCH2", "OSBPL10", "PIM1", "PIM2", 
  "PRDM1", "PRDM15", "PRKDC", "PRRC2C", "PTPN1", 
  "RFTN1", "S1PR2", "SETD1B", "SGK1", "SOCS1", 
  "SPEN", "STAT3", "STAT6", "TBCC", "TBL1XR1", 
  "TET2", "TMEM30A", "TMSB4X", "TNFAIP3", "TNFRSF14", 
  "TOX", "TP53", "TP73", "UBE2A", "WEE1", 
  "XBP1", "ZFP36L1", "MYD88HOTSPOT", "BCL2_SV", "BCL6_SV"
))

best_opt_model_matrix <- all_full_status %>%
  select(best_opt_model_genes)
```

Alternatively, you can load the stored optimized model `best_opt_model.rds` from extdata:
```{r, message=FALSE, warning=FALSE, eval = FALSE}
loaded_model <- DLBCLone_load_optimized(
        dirname(
            system.file(
                "extdata/models",
                "best_opt_model.rds",
                package = "GAMBLR.predict"
            )
        ),
        default_model
    )

best_opt_model <- DLBCLone_activate( # Reactivates stored model setting the UMAP projection
  loaded_model, 
  force = TRUE
)
```

![](concept_map.png)

*There are dedicated DLBCLone Tutorial Pages that cover:*

- UMAP Projection Functions
- Optimizing Parameters
- Storing & Activating DLBCLone Models
- Predicting Samples
- Validation
- Mixture Model
- KNN Model